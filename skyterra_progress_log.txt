## SkyTerra Project - Progress and Issue Log

**NOTA PARA EL USUARIO/DESARROLLADOR:** Por favor, actualiza este archivo a medida que se completan las tareas o surgen nuevos problemas. Esto ayudar√° a mantener un seguimiento claro del progreso y facilitar√° la colaboraci√≥n, incluso si trabajas con diferentes asistentes de IA o en diferentes sesiones. Marca las tareas completadas con `[COMPLETADO]` o `[RESUELTO]`.

**Fecha de √öltima Actualizaci√≥n:** 2025-06-13 (PropertyDetails.jsx actualizado con soporte de arriendo, en curso filtros de modalidad; Backend documentos: Modelo y API completados; pendiente approve/reject)

### **PLAN DE IMPLEMENTACI√ìN GLOBAL AJUSTADO**

**Principios Gu√≠a:**
1.  Estabilidad y Seguridad PRIMERO.
2.  Funcionalidad Core para el MVP (Producto M√≠nimo Viable) y Experiencia IA Central despu√©s.
3.  Mejoras UX incrementales y continuas.
4.  Expansi√≥n a largo plazo (m√≥vil, internacionalizaci√≥n).

---

**Fase 0: Estabilizaci√≥n Inmediata (Urgente)**
*   **Objetivo:** Asegurar una base t√©cnica s√≥lida y resolver problemas cr√≠ticos antes de a√±adir nuevas funcionalidades mayores.
*   **Tareas:**
   
    1.  **[COMPLETADO - 12 Jun 2025]** üõ† Migraci√≥n MUI Grid v2.
        *   **Subtarea:** `AdminDashboardPage.jsx` y resto de componentes revisados; todos usan Grid de `@mui/material` correctamente.
        *   **Subtarea:** Revisi√≥n global completa, sin instancias restantes de Grid v1.
    2.  **[RESUELTO - 12 Jun 2025]** üêõ Error "Maximum update depth exceeded" en `MapView.jsx`.
        *   **Contexto:** Ajustes en dependencias de `useEffect` verificados en pruebas locales; no se reproduce el error.
    3.  **[RESUELTO - 12 Jun 2025]** Vistas admin placeholders iniciales reemplazadas (Usuarios, Propiedades, Tickets, Configuraci√≥n) y API tickets creada.

---

**Fase 1: N√∫cleo de Negocio y Experiencia IA Central (M√°xima Prioridad)**
*   **Objetivo:** Implementar las funcionalidades centrales que definen la propuesta de valor de SkyTerra, con un fuerte √©nfasis en la b√∫squeda inteligente y la versatilidad del listado de propiedades.
*   **Tareas:**
    1.  **[EN PROGRESO]** üß† **IA Search Bar - Experiencia Central (Alcance Extendido):**
        *   **Subtarea (Backend):** Se a√±adi√≥ l√≥gica en `AISearchView` para interpretar consultas complejas mediante `GeminiService` y devolver top-3 propiedades (commit 12-Jun-2025).
        *   **Subtarea (Backend):** Pendiente integraci√≥n con APIs geoespaciales externas.
        *   **Subtarea (Frontend):** Pendiente UI de resultados y fly-to.
        *   **Subtarea (IA/Contenido):** Pendiente FAQs.
        *   **Estado:** Backend funcional b√°sico, faltan refinamientos y frontend.
    2.  **[EN PROGRESO]** ‚ûï Soporte para Arriendo/Alquiler:
        *   **Backend:** Modelo `Property` y serializers actualizados (campos `listing_type`, `rent_price`, `rental_terms`). Falta aplicar migraciones en entorno de producci√≥n.
        *   **Frontend:**
            *   **[COMPLETADO]** Formulario `PropertyForm` con select de modalidad y campos condicionales `rentPrice` y `rentalTerms`.
            *   **[COMPLETADO]** Servicio API mapea correctamente los nuevos campos.
            *   **[COMPLETADO]** `PropertyCard` muestra precio seg√∫n modalidad (venta o arriendo).
            *   **[COMPLETADO - 13 Jun 2025]** Actualizar `PropertyDetails.jsx` para exhibir modalidad y precio de arriendo.
            *   **[COMPLETADO - 13 Jun 2025]** Se a√±adi√≥ pesta√±a "Documentos" en `PropertyForm.jsx` para permitir subida de PDFs, DOC y planos (hasta 10 archivos). UI con listado, remover y alerta informativa.
            *   **[COMPLETADO - 13 Jun 2025]** Backend: Modelo `PropertyDocument` implementado (relaci√≥n 1-a-N), con campos `file`, `doc_type`, `description`, `uploaded_at`.
            *   **[COMPLETADO - 13 Jun 2025]** API: Se a√±adi√≥ `PropertyDocumentViewSet` (CRUD), ruta `/api/documents/`, serializer y registro en `urls.py`; `PropertySerializer` actualizado y manejo de `new_documents` en vistas.
            *   **[COMPLETADO - 26 Jun 2025]** Backend: Acciones `approve` / `reject` a√±adidas a `PropertyDocumentViewSet`; actualizaci√≥n de estado y transici√≥n autom√°tica de `publication_status`. **Verificado: `send_property_status_email` ya se llama.**
            *   **[PENDIENTE]** Notificaciones: Email al propietario cuando su propiedad cambia de estado (pendiente ‚Üí approved/rejected).
            *   **[PENDIENTE]** Frontend: Mostrar estado de verificaci√≥n y lista de documentos subidos en `PropertyDetails.jsx` (s√≥lo para owner y admin).
            *   **[DESCARTADO - 13 Jun 2025]** Filtros manuales eliminados del UI principal; la IA gestionar√° filtros internamente.
        *   **Admin:**
            *   **[COMPLETADO - 16 Jun 2025]** Ajustar vistas de propiedades (AdminDetailedPropertiesPage) para listar y filtrar por modalidad (venta/arriendo/ambas).
        *   **QA:**
            *   **[PENDIENTE]** Ejecutar y verificar migraciones (`makemigrations` + `migrate`).
    3.  **[RESUELTO - 13 Jun 2025]** üìà **M√©trica de Plusval√≠a Inteligente (Recovery Score‚Äêstyle):**
        *   **Backend:** Campo `plusvalia_score` en modelo `Property` con c√°lculo autom√°tico; migraciones aplicadas.
        *   **Servicio `PlusvaliaService` v2:** Combina 10 factores (valor de mercado externo, tasa apreciaci√≥n hist√≥rica, demanda interna por visitas, precio/hect√°rea, agua, vistas, tama√±o, proximidad, modalidad, IA). Integra **ClearAVM / Property Valuation API** para AVM y apreciaci√≥n hist√≥rica [fuente](https://www.clearcapital.com/products/property-valuation-api/). **Completado** (stub externo, pesos iniciales, c√°lculos y fallback a neutro).
        *   **Demanda:** Nuevo modelo `PropertyVisit` para registrar vistas; falta endpoint y frontend para registrar cada visualizaci√≥n de detalle de propiedad.
        *   **Seguridad:** `plusvalia_score` solo visible para usuarios `is_staff`.
        *   **Frontend:** **[COMPLETADO - 16 Jun 2025]** Mostrar m√©trica en vistas admin (AdminDetailedPropertiesPage) y panel de detalles de propiedad (solo staff).
        *   **Pr√≥ximos pasos:** Ajustar pesos tras recopilar datos reales y conectar servicios externos en entorno prod.
    4.  **[COMPLETADO - 26 Jun 2025]** üë§ **Creaci√≥n de Cuenta Admin por Defecto:**
        *   **Subtarea (Backend):** Implementar un script, `management command`, o proceso de inicializaci√≥n para crear un superusuario con `username='admin'` y `password='SkyTerra3008%'` (la contrase√±a debe ser manejada de forma segura, idealmente establecida en el primer despliegue o mediante variables de entorno para el admin inicial). **Verificado: `create_default_admin.py` ya existe y funciona.**

---

**Fase 2: Funcionalidades de Usuario, Comunidad y UX Esencial (Alta Prioridad)**
*   **Objetivo:** Enriquecer la interacci√≥n del usuario con la plataforma y mejorar la usabilidad general.
*   **Tareas:**
    1.  **[COMPLETADO - 16 Jun 2025]** ‚ù§Ô∏è **Funcionalidad de Favoritos/Guardados (MVP):**
        *   Backend: Modelo `Favorite`, serializer y `FavoriteViewSet` (`/api/favorites/`).
        *   Frontend: `PropertyCard` muestra bot√≥n bookmark para guardar/quitar; `favoritesService` en `api.js`.
        *   Pendiente: Vista dedicada "Favoritos" en dashboard.
    2.  **[EN PROGRESO - 26 Jun 2025]** üë§ **P√°gina de Perfil de Usuario (B√°sica):**
        *   **Frontend:** A√±adida pesta√±a "Mi Perfil" en `Dashboard.jsx` y componente `UserProfile.jsx` para edici√≥n de datos b√°sicos.
        *   **Backend:** A√±adido endpoint `/api/auth/profile/` (`ProfileUpdateView`) para actualizar el perfil del usuario.
        *   Para compradores/arrendatarios: Ver favoritos, gestionar datos b√°sicos de perfil.
        *   Para vendedores/propietarios: Ver y gestionar sus publicaciones (venta y arriendo), datos de perfil.
        *   Requiere l√≥gica de autenticaci√≥n y roles.
    3.  **[PENDIENTE]** üí¨ **Mensajer√≠a Interna (B√°sica) o Flujo de Contacto Mejorado:**
        *   Dise√±ar e implementar un sistema para que los usuarios puedan contactar a los publicadores sobre propiedades espec√≠ficas.
        *   Considerar si se implementa un chat interno completo o un formulario de contacto robusto con notificaciones por email al propietario.
    4.  **[PENDIENTE]** ‚ú® **Feedback Visual Claro y Consistente:**
        *   Revisar y mejorar el uso de Snackbars, loaders, modales de confirmaci√≥n, y mensajes de √©xito/error en toda la aplicaci√≥n para una UX m√°s pulida.
    5.  **[PENDIENTE]** üè° **Redise√±o UI `Dashboard.jsx` (Panel de Usuario Propietario/Vendedor/Admin):**
        *   Aplicar dise√±o minimalista y moderno con cards para propiedades.
        *   Paginaci√≥n. Bot√≥n "Crear Nueva Propiedad".
        *   Asegurar que la UX est√© personalizada seg√∫n el rol del usuario logueado (qu√© acciones y vistas est√°n disponibles).

---

**Fase 3: Expansi√≥n de Funcionalidad y Maduraci√≥n (Media Prioridad)**
*   **Objetivo:** A√±adir funcionalidades m√°s complejas y refinar la plataforma.
*   **Tareas:**
    1.  **[PENDIENTE]** üí≥ **Implementar Sistema de Transacciones B√°sico:**
        *   **Primero:** Definici√≥n clara del alcance (¬øSon ofertas formales, reservas, un sistema de pago inicial?).
        *   Dise√±o detallado de la UX y los flujos antes de la implementaci√≥n.
        *   Backend: Modelos, l√≥gica de negocio, posibles integraciones con pasarelas de pago.
        *   Frontend: Interfaz para gestionar estas transacciones.
    2.  **[EN PROGRESO]** üé® **Unificar Tema Oscuro y Estilo Visual Globalmente:**
        *   Asegurar consistencia de dise√±o, tipograf√≠a, colores, y componentes en toda la aplicaci√≥n. **Problema identificado:** Persistencia de estilos `backgroundColor` inline y en reglas CSS espec√≠ficas con mayor prioridad (`!important`) sobre el tema global Liquid Glass. Requiere una refactorizaci√≥n exhaustiva para eliminar estilos `hard-coded` y confiar plenamente en las variantes de tema de MUI (`variant="glass"`) y clases auxiliares.
    3.  **[PENDIENTE]** üì± **Optimizaci√≥n M√≥vil Detallada (para la Web App) y Pruebas de Accesibilidad.**
        *   Asegurar que la PWA o web app sea completamente responsive y accesible.
    4.  **[PENDIENTE]** üí° **Onboarding/Ayuda R√°pida para nuevos usuarios:**
        *   Tooltips, gu√≠as interactivas cortas, o integraci√≥n con la IA para ayudar a los usuarios a entender c√≥mo usar las funciones clave.

---

**Fase 4: Crecimiento y Plataformas Adicionales (Largo Plazo / Estrat√©gico)**
*   **Objetivo:** Expandir el alcance y las capacidades de SkyTerra.
*   **Tareas:**
    1.  **[PENDIENTE]** üìä **Panel Anal√≠tico para Administradores:**
        *   Estad√≠sticas sobre propiedades, usuarios, b√∫squedas, etc.
    2.  **[PENDIENTE]** üîî **Notificaciones Avanzadas (Email/In-app):**
        *   Alertas personalizadas, res√∫menes, etc.
    3.  **[PENDIENTE]** üåç **Internacionalizaci√≥n:**
        *   Soporte para m√∫ltiples idiomas (ej. ingl√©s) en contenido y UI.
    4.  **[PENDIENTE]** üì± **Desarrollo de Aplicaciones M√≥viles Nativas (Android & iOS):**
        *   **Consideraciones Iniciales:**
            *   **Alcance MVP M√≥vil:** Definir funcionalidades esenciales para la v1 de las apps.
            *   **Tecnolog√≠a:** Evaluar React Native, Flutter, o Nativo (Swift/Kotlin).
            *   **API Backend:** Debe estar preparada para soportar clientes m√≥viles.
            *   **Dise√±o UX/UI Espec√≠fico para M√≥vil:** No una simple adaptaci√≥n de la web.
            *   **Gesti√≥n de Estado y Datos Offline:** Considerar si se requiere.
            *   **Push Notifications:** Planificar integraci√≥n (FCM/APNs).
            *   **Recursos:** Evaluar necesidades de equipo.

---

**ROADMAP DE REDISE√ëO UI "LIQUID GLASS" (Estilo macOS)** ‚Äî *[DETALLADO - 13 Jun 2025]*

*Visi√≥n:* Transicionar todo el frontend a un dise√±o minimalista inspirado en macOS con fondos transl√∫cidos, tipograf√≠a limpia y micro-interacciones fluidas. Se introduce un *theme* unificado `liquidGlassTheme` y variantes `glass` en los componentes MUI. El backend proveer√° assets retina, versionado de dise√±o y feature-flags para gradual rollout.

### Fase GL-0 ‚Ä¢ Auditor√≠a & Definici√≥n (1 sem)
1. Inventario completo de componentes React/MUI y estilos CSS/inline.  
2. Matriz de dependencias visuales ‚Üî payload backend (ej. `publication_status`, `listing_type`).  
3. Informe de inconsistencias + propuesta de tokens.

### Fase GL-1 ‚Ä¢ Fundaciones de Dise√±o (1 sem)
1. Crear `src/theme/tokens.js` con:  
   ‚Ä¢ `surface-0` #0e0e0e, `surface-1` rgba(255,255,255,.04), `surface-glass` rgba(255,255,255,.12) + blur(10px).  
   ‚Ä¢ `accent` #66ccff.  
   ‚Ä¢ Escala tipogr√°fica `14/18/22/28/40`, grid 4 px.  
2. Implementar `liquidGlassTheme.js` y registrar variantes `glass` para `Paper`, `Card`, `AppBar`, `Drawer`.  
3. P√°gina interna `/styleguide` (Storybook o ruta React) para previsualizar tokens.

### Fase GL-2 ‚Ä¢ Layout & Navegaci√≥n (2 sem)
1. Sidebar ‚Üí off-canvas `Drawer` (`permanent` desktop / `temporary` mobile) con `surface-glass`.  
2. TopBar minimal (56 px) autohide on-scroll m√≥vil.  
3. Reescritura de grids: `repeat(auto-fit,minmax(280px,1fr))`.  
4. Tablas ‚Üí `@mui/x-data-grid` sin sombras.

### Fase GL-3 ‚Ä¢ Conversi√≥n de Componentes (3 sem, rolling)
Para cada componente: migrar a `sx` + tokens, sustituir sombras por bordes semitransparentes, aplicar variante `glass` si es contenedor.
Prioridad: `Dashboard` ‚Üí `CreateProperty` ‚Üí `PropertyCard`+Mapbox popups ‚Üí Vistas Admin ‚Üí Formularios Auth ‚Üí `AISuggestionPanel`.

### Fase GL-4 ‚Ä¢ Animaciones & Micro-interacciones (1 sem)
1. Wrapper `GlassFade` (opacity+blur+scale) con Framer-motion.  
2. Ripple buttons (`scale(.96)` + inset-shadow 150 ms).  
3. Page-transitions v√≠a `AnimatePresence`.  
4. Map fly-to duration 4.5 s.

### Fase GL-5 ‚Ä¢ Backend & Assets (1 sem paralela)
1. Header `X-Design-Version: liquid-v1` para compatibilidad.  
2. Endpoints `/images` sirven WebP 2√ó retina.  
3. Streaming progresivo de tours.

### Fase GL-6 ‚Ä¢ Performance & QA (1 sem)
1. Lighthouse ‚â• 85 m√≥vil/escritorio.  
2. Test cross-browser; fallback s√≥lido cuando no haya `backdrop-filter`.  
3. WCAG 2.1 AA.

### Fase GL-7 ‚Ä¢ Lanzamiento & Gobernanza (continuo)
1. Feature-flag `liquidGlass` por usuario.  
2. Documentaci√≥n de tokens y patrones en Notion.  
3. ESLint rule: prohibido usar hex directo, s√≥lo tokens.

---

**Historial de Cambios Recientes en el Log:**
*   2025-06-12: Migraci√≥n MUI Grid finalizada y bug de MapView resuelto tras pruebas.
*   2025-06-12: A√±adida l√≥gica de IA en `AISearchView` para devolver top 3 sugerencias basadas en BD.
*   2025-06-12: Detectadas vistas admin placeholders vac√≠as; se registra como NUEVO issue en Fase 0.
*   2025-06-16: Implementado nuevo sistema de registro con selecci√≥n de tipo de vendedor ("Vendo mi terreno" vs "Vendedor profesional") y formularios adaptativos seg√∫n rol. Prototipo UI reactivo incluido en `AuthForms.jsx`; dashboard existente ya lista "Mis Propiedades" con bot√≥n "+" para nuevas publicaciones.
*   2025-06-16: Dashboard mejorado con pesta√±as Resumen/Mis Propiedades/B√∫squedas Guardadas/Favoritos, l√≥gica de l√≠mite de 3 publicaciones para cuentas individuales y carga din√°mica de favoritos (`favoritesService`).
*   2025-05-29: Reestructuraci√≥n completa del plan en Fases (0 a 4).
*   2025-05-29: Elevada prioridad y alcance de la "IA Search Bar - Experiencia Central" a Fase 1.
*   2025-05-29: Integrado "Soporte para Arriendo/Alquiler" como alta prioridad en Fase 1.
*   2025-05-29: A√±adida tarea "Creaci√≥n de Cuenta Admin por Defecto" a Fase 1.
*   2025-05-29: A√±adida "Desarrollo de Aplicaciones M√≥viles Nativas (Android & iOS)" a Fase 4 con consideraciones iniciales.
*   2025-05-29: Re-priorizadas otras tareas seg√∫n el nuevo enfoque estrat√©gico.
*   2025-05-30: Actualizado el estado de los puntos 3 y 4 de la Fase 0 (edificios 3D resuelto, error de update depth pospuesto/no prioritario).
*   **[RESUELTO - 3 Jun 2025]** üêõ **BUG DE REGISTRO DE USUARIOS SOLUCIONADO:**
    * **Problema identificado:** Bug que imped√≠a crear nuevas cuentas de usuario
    * **Causa ra√≠z:** 
        - Migraciones de Django no aplicadas completamente
        - Configuraci√≥n incorrecta de URLs en entorno Codespaces
        - Manejo de errores insuficiente en frontend y backend
    * **Soluciones implementadas:**
        1. ‚úÖ Aplicaci√≥n completa de migraciones Django
        2. ‚úÖ Mejora en detecci√≥n autom√°tica de entorno (Codespaces vs localhost)
        3. ‚úÖ Validaciones mejoradas en formulario de registro:
            - Email √∫nico y formato v√°lido
            - Username con caracteres permitidos (3+ chars)
            - Contrase√±a segura (8+ chars, may√∫s/min√∫s/n√∫mero)
        4. ‚úÖ Logging detallado para debugging en backend y frontend
        5. ‚úÖ Mejor manejo de errores con mensajes espec√≠ficos
    * **Testing realizado:**
        - Endpoint `/api/auth/register/` funciona correctamente
        - Formulario frontend valida datos correctamente
        - Respuestas de error claras y espec√≠ficas
        - Usuarios creados exitosamente (IDs 5, 6 durante testing)
    * **Estado:** Completamente funcional
    * **Pr√≥ximos pasos:** Continuar con testing de flujo completo registro ‚Üí login ‚Üí dashboard
*   2025-06-12: Rutas de administraci√≥n actualizadas en `App.jsx` para integrar Usuarios, Propiedades detalladas, Tickets y Configuraci√≥n.
*   2025-06-12: Implementada lista de Tickets en Admin y API REST para tickets (endpoints /api/admin/tickets/).
*   2025-06-12: Backend de soporte para arriendo actualizado (campos nuevos en Property y serializers).
*   2025-06-12: Frontend integrado con soporte de arriendo en formulario y card; pendiente detalles y filtros.
*   2025-06-13: A√±adido `plusvalia_score` con c√°lculo IA + datos externos; modelo `PropertyVisit`; servicio `ExternalMarketDataService` y actualizaci√≥n de `PlusvaliaService` v2.
*   2025-06-13: Actualizado Fase 1 con la nueva tarea 'M√©trica de Plusval√≠a Inteligente'.
*   2025-06-13: A√±adido Roadmap detallado de Redise√±o UI "Liquid Glass" y marcada la tarea general de unificaci√≥n de tema como parte del nuevo roadmap GL.
*   2025-06-13: Cr√≠tica de dise√±o fuerte y lineamientos minimalistas incorporados.
*   **[RESUELTO - 13 Jun 2025]** Filtros de Modalidad (Venta/Arriendo) implementados en frontend:
    *   MapView.jsx ahora env√≠a `listing_type` en par√°metros API (manual y AI).
    *   AISearchBar.jsx soporta `listingType` en chips y filtros sugeridos.
    *   Propagaci√≥n via `aiAppliedFilters` garantizada.
*   **[COMPLETADO - 13 Jun 2025]** Se implement√≥ `liquidGlassTheme` con tokens y se reemplaz√≥ azul primario por paleta neutra; componentes principales actualizados (App, Dashboard, AISearchBar, AdminLayout) para usar colores del tema.
*   2025-06-13: **Refactor UI ‚Äì Apple-style Liquid Glass Phase**
    * Global theme updated: `MuiPaper` and `MuiCard` variant `glass` ‚Üí fondo `rgba(255,255,255,0.12)` + borde 25 % alpha + blur.
    * Avatar `IconButton` + `Menu` aclarados; animaci√≥n `glassGlow` deshabilitada en popup.
    * `AISearchBar` input y panel de resultados migrados al nuevo look transl√∫cido.
    * `AISuggestionPanel` ahora usa fondo claro y borde acorde.
    * Token `surface-glass` aplicado a inputs (OutlinedInput root).
    * **Pendiente:** Migrar Dashboard, PropertyDetails, CreateProperty y dem√°s vistas que a√∫n usan `rgba(22,27,34,*)` directo a `variant="glass"` o al nuevo token.
*   **[COMPLETADO - 14 Jun 2025]** Redise√±o de Dashboards (Usuario y Admin) al estilo Liquid Glass minimalista:
    *  Se reemplazaron colores azules (#3b82f6, #8faacc, etc.) por acento neutro (#a0a0a0) y colores de tema.
    *  Cards, Paper y m√©tricas ahora usan variante `glass` con fondos transl√∫cidos y bordes consistentes.
    *  √çconos y botones actualizados para seguir la paleta neutra; bordes y hovers adaptados.
    *  Gr√°ficos en Admin Dashboard recodificados con color neutro y contenedores transl√∫cidos.
*   **[ACTUALIZADO - 14 Jun 2025]** UI Legacy Cleanup:
    *   Eliminadas pesta√±as de filtros manuales y otros componentes redundantes (`Dashboard.jsx`, `FilterPanel.jsx`) para alinear la experiencia con la nueva filosof√≠a *AI-first* y el roadmap "Liquid Glass".
    *   Se aprueba iniciar un **redise√±o completo Apple-style** enfocado en el flujo del Vendedor (creaci√≥n de publicaciones, anal√≠ticas y gesti√≥n de planes), incorporando las sugerencias de estructura modular y nuevas pesta√±as detalladas en la conversaci√≥n del 14-Jun.
    *   Pr√≥ximos pasos: definici√≥n detallada de pantallas, wireframes y tokens de animaci√≥n.
*   **[ACTUALIZADO - 14 Jun 2025]** Limpieza Admin Dashboard:
    *   Se removieron rutas e importaciones de `Admin*` pages en `App.jsx` para simplificar la V2 minimal.
    *   Los componentes admin y l√≥gica de verificaci√≥n de documentos, m√©tricas y gesti√≥n permanecen en `frontend/src/components/admin/` para reaprovechar en una futura versi√≥n Staff-Only.
*   **[COMPLETADO - 14 Jun 2025]** Integrado flujo de creaci√≥n de publicaci√≥n:
    *   Se a√±adi√≥ componente `CreatePublicationWizard.jsx` (wizard 4 pasos) con estilo Liquid Glass y validaci√≥n b√°sica.
    *   `App.jsx`: Ruta protegida `/create-property` registrada y acceso solo para usuarios autenticados.
    *   `Dashboard.jsx`: Bot√≥n "Crear nueva publicaci√≥n" ahora navega al wizard y ya no est√° deshabilitado.
    *   Se emplea `Paper variant="glass"` y tokens de tema en wizard; se mantiene coherencia visual.
*   **[COMPLETADO - 14 Jun 2025]** Visibilidad de documentos en Dashboard:
    *   `Dashboard.jsx` ahora carga las propiedades del usuario v√≠a `getUserProperties`.
    *   Lista "Mis Propiedades" muestra estado de verificaci√≥n de documentos con chips (Aprobados, Pendientes, Rechazados, Sin documentos).
    *   Cada card es Paper glass y enlaza a los detalles de propiedad.
*   **[COMPLETADO - 14 Jun 2025]** Ruta admin para revisi√≥n de documentos:
    *   `AdminDocumentsReviewPage.jsx` conectado v√≠a ruta `/admin/documents` con protecci√≥n solo para `is_staff`.
    *   Navegaci√≥n autom√°tica tras login de admin y desde men√∫ de usuario.
*   **[MEJORA - 14 Jun 2025]** IA Search Bar ‚Äì Panel de sugerencias refinado:
    *   `AISuggestionPanel.jsx` limita visualizaci√≥n a top-3 sugerencias (`MAX_DISPLAY = 3`) y fija ancho 380 px en lateral izquierdo (20 px de margen).
    *   Alineado con requisito de UI de mostrar 3 propiedades y panel fijo.
*   **[COMPLETADO - 14 Jun 2025]** Notificaciones de email al propietario por cambio de estado:
    *   Implementado `email_service.send_property_status_email` usando `django.core.mail.send_mail`.
    *   `PropertyDocumentViewSet.approve/reject` dispara correo autom√°tico al cambiar `publication_status`.
*   **[COMPLETADO - 14 Jun 2025]** Script de superusuario por defecto:
    *   Management command `create_default_admin` en `properties/management/commands/` crea un superuser si no existe.
    *   Usa variables de entorno `ADMIN_USERNAME`, `ADMIN_PASSWORD`, `ADMIN_EMAIL` con defaults (`admin` / `SkyTerra3008%`).
*   **[COMPLETADO - 14 Jun 2025]** M√©trica de visitas registrada:
    *   Modelo `PropertyVisit` ya exist√≠a; se a√±adi√≥ `PropertyVisitSerializer`, `PropertyVisitViewSet` y ruta `/api/property-visits/` (POST).
    *   `PropertyDetails.jsx` registra autom√°ticamente una visita al cargar la propiedad.
*   **[MEJORA - 14 Jun 2025]** PropertyCard convertido a estilo Glass:
    *   `PropertyCard.jsx` usa ahora `<Card variant="glass">` removiendo sombras previas.
*   **[RESUELTO - 13 Jun 2025]** Se elimin√≥ `boxShadow` global y en variante glass en `liquidGlassTheme.js` para evitar halo gigante.
*   **[MEJORA - 14 Jun 2025]** IA Search ‚Äì GeminiService refinado:
    *   `backend/properties/services.py` ahora conserva recomendaciones con IDs v√°lidos de la IA y solo genera sugerencias nuevas cuando es necesario.
    *   Mensajes del asistente se mantienen coherentes y se evita mostrar 3 tarjetas irrelevantes.
*   **[RESUELTO - 14 Jun 2025]** Halo blanco en pop-ups Mapbox eliminado:
    *   `frontend/src/index.css` ‚Äì `.mapboxgl-popup-content`, `.mapboxgl-popup-tip` y `.mapboxgl-popup-tip-inner` ahora son transparentes, sin borde ni sombra.
    *   El pop-up muestra solo la tarjeta glass interior, sin doble fondo.
*   **[EN PROGRESO - 14 Jun 2025]** Frontend: Componente `PropertyPreviewModal.jsx` creado (modal transl√∫cido con galer√≠a, info b√°sica y CTA a /register). Integrado en `MapView.jsx`; al hacer clic en un pin sin `auth_token` se abre la vista previa en lugar de navegar. Falta estilizar header y probar responsivo.
*   **[MEJORA - 14 Jun 2025]** `PropertyPreviewSerializer` ahora incluye campo `images` (m√°x 5) para galer√≠a en modal.
*   **[COMPLETADO - 14 Jun 2025]** Backend: Modelo `ComparisonSession`, serializer y `ComparisonSessionViewSet` expuestos en `/api/compare/` (crea/actualiza lista de hasta 4 propiedades por usuario o sesi√≥n an√≥nima).
*   **[EN PROGRESO - 14 Jun 2025]** Frontend: `CompareView.jsx` (liquid glass) creado y ruta `/compare` agregada en `App.jsx`. `PropertyCard.jsx` incluye bot√≥n de comparar que crea/actualiza sesi√≥n v√≠a `/api/compare/` y navega a vista. Falta dise√±o responsive detallado y sincronizar m√∫ltiples adiciones.
*   **[COMPLETADO - 15 Jun 2025]** Backend: `TourViewSet` ahora maneja subida de paquetes `.zip`/`.ggpkg`. El endpoint `create` acepta un `package_file`, lo descomprime en una ruta √∫nica (`/media/tours/<uuid>`), valida que exista `index.html`, y guarda la URL p√∫blica en el modelo `Tour`. Incluye validaciones de seguridad.
*   **[COMPLETADO - 15 Jun 2025]** Frontend: Creado componente reutilizable `Pano2VRViewer.jsx`. Integrado en `PropertyDetails.jsx`: la pesta√±a "Tours" ahora renderiza directamente el tour 360¬∞ si existe uno de tipo 'package', en lugar de mostrar una lista.
*   **[AJUSTE - 15 Jun 2025]** `PropertyPreviewModal` ahora usa carousel nativo con botones; se elimina dependencia `react-swipeable-views` para evitar conflictos de peer-deps. `package.json` actualizado.
*   **[COMPLETADO - 15 Jun 2025]** Backend: Implementado modelo `SavedSearch`, serializer y `SavedSearchViewSet` (`/api/saved-searches/`) para que usuarios registrados guarden filtros y activen alertas por correo.
*   **[COMPLETADO - 15 Jun 2025]** Mapa ‚Äì Ciudades y Puntos de Inter√©s (POI):
    *   Se a√±adi√≥ iconograf√≠a (`icon-image`) y texto a las capas de ciudades (`city-labels-major`, `city-labels-minor`) y POIs (`poi-major`, `poi-minor`).
    *   Filtros refinados para que solo aparezcan:
        *   Pa√≠ses desde zoom 0.
        *   Ciudades principales (rank ‚â§ 5) desde zoom ‚â•3.
        *   Ciudades menores (rank >5) desde zoom ‚â•7.
        *   POI mayores desde zoom ‚â•10 y menores desde zoom ‚â•13.
    *   Uso de `coalesce` para manejar `rank/label_rank` nulos y evitar warnings de tipo.
    *   Eliminados errores de consola relacionados con expresiones Mapbox (`label_rank expected type number`).
    *   Ajustado estilo de texto/iconos para evitar saturaci√≥n visual y hacer progresivo el detalle.
*   **[15 Jun] Jerarqu√≠a de etiquetas refinada: `city-labels-major` (zoom‚â•4, rank‚â§4), `city-labels-medium` (zoom‚â•6), `town-labels` (zoom‚â•8) y `village-labels` (zoom‚â•10).
*   **[15 Jun] Fuentes unificadas: familia *Source Code Pro* (Bold/Semibold/Regular) para alinear con tipograf√≠a principal del sitio.
*   **[15 Jun] Localidades peque√±as ahora filtradas: pueblos (zoom‚â•10 rank‚â§10) y aldeas (zoom‚â•12).
*   **[15 Jun] POI visibles: mayores desde zoom 11, menores desde 14; tipograf√≠a Source Code Pro.

---

## **PLAN DE DESPLIEGUE A PRODUCCI√ìN (AWS)**

> **Objetivo:** Tener un entorno productivo robusto, seguro y escalable en AWS para el MVP de SkyTerra antes de Q3-2025.

### 1. Arquitectura Propuesta (Alta Disponibilidad)
* **VPC** con subredes p√∫blicas y privadas en 2 AZ (us-east-1a / 1b)
* **ALB (Application Load Balancer)** frente a 2√ó instancias **EC2** (Autoscaling group) con Docker + Gunicorn + Nginx (Backend Django)
* **RDS PostgreSQL** (Multi-AZ, gp3  db.t3.medium, backups 7 d√≠as)
* **Elasticache Redis** (para sesiones y caching)
* **S3**: Media (im√°genes, tours, documentos) + versi√≥n ‚Äë> CloudFront para servir est√°tico
* **S3** bucket adicional para artefactos de CI/CD (builds)
* **Route 53** para DNS (skyterra.cl, api.skyterra.cl, cdn.skyterra.cl)
* **ACM** ‚Äì TLS certificados para ALB y CloudFront
* **ECR** para almacenamiento de im√°genes Docker
* **AWS Step Functions + Lambda (futuro)** para procesamiento pesado (ej: IA, generador de thumbnails)

### 2. Flujo CI/CD (GitHub Actions)
1. **build_frontend**: `npm ci ‚Üí npm run build` ‚Üí artefacto comprimido ‚Üí upload a S3 (`frontend-builds/commitSHA.zip`)
2. **build_backend**: `docker build` ‚Üí push a ECR con tag commitSHA
3. **deploy_staging** (branch *develop*):
   * EB CLI √≥ ECS task (Fargate) actualiza containers 
   * Frontend build sin compresi√≥n, servido por CloudFront-dev
   * Corre migraciones `python manage.py migrate --noinput`
   * Smoke tests (`pytest -m smoke`)
4. **deploy_prod** (merge *main* + tag vX.Y.Z):
   * Blue-green en EC2 ASG ‚Üí health-check antes de cortar tr√°fico
   * Frontend build se sube a bucket S3-prod y se invalida CloudFront
   * Migraciones + comando para crear superadmin si no existe
   * Notificaci√≥n Slack (#deploys) con changelog auto-generado

### 3. Seguridad y Gobernanza
* **IAM roles** m√≠nimos (EC2, GitHub OIDC)
* SG restrictivos (solo ALB ‚Üí EC2, EC2 ‚Üí RDS/Redis)
* Secrets en **AWS Secrets Manager** (DB creds, email SMTP)
* **WAF** delante de ALB + reglas OWASP top-10
* Backups automatizados (RDS + S3 lifecycle)
* **CloudTrail** & AWS Config habilitados

### 4. Observabilidad / DevOps
* **CloudWatch Logs** + m√©tricas custom (latencia API, errores 5xx, duraci√≥n de migraciones)
* **Prometheus + Grafana Cloud** (opcional) para m√©tricas de aplicaci√≥n
* **Sentry** para errores JS y Django
* **StatusCake** (heartbeat)

### 5. Costeo Estimado Mensual (USD)
| Componente | Inicial | Escalable |
|------------|---------|-----------|
| EC2 t3.medium √ó2 | $35 | +$35 por inst extra |
| RDS db.t3.medium | $75 | seg√∫n storage |
| ALB | $20 | tr√°fico |
| S3 + CloudFront | $10 | uso |
| Otros (Redis, transfer, backups) | $15 | uso |
| **Total** | **‚âà $155** | variable |

### 6. Roadmap Pr√≥ximos Pasos
1. **[PENDIENTE]** Crear repo `skyterra-infra` con Terraform IaC (modular)
2. **[PENDIENTE]** Configurar GitHub Actions con OIDC hacia AWS
3. **[PENDIENTE]** Dockerizar backend (multi-stage) y frontend (Nginx static)
4. **[PENDIENTE]** Implementar S3 storage en Django (`django-storages`, presigned URLs)
5. **[PENDIENTE]** Configurar CloudFront + custom domain para frontend
6. **[PENDIENTE]** Ajustar CORS y CSRF (api.skyterra.cl ‚Üî app)
7. **[PENDIENTE]** Pruebas de carga (k6) antes de GA
8. **[PENDIENTE]** Revisi√≥n de seguridad por OWASP ZAP
9. **[PENDIENTE]** Manual de rollback y playbook incidentes

### 7. Brechas Detectadas en Revisi√≥n 13-Jun-2025
Tras revisar frontend y backend actuales se identifican los siguientes vac√≠os adicionales:

1. **Filtros de Modalidad (Venta/Arriendo)**
   * Falta en SearchBar y en lista de resultados (`PropertyList`, `MapResultsOverlay`).
   * Endpoint backend ya acepta `listing_type` en `filterset_fields`, solo falta consumirlo.

2. **Gesti√≥n de Documentos en Admin**
   * Crear vista `AdminDocumentsReviewPage.jsx` dentro de `/admin` para aprobar/rechazar documentos.
   * **[EN PROGRESO]** Endpoint backend: `PropertyDocumentViewSet` implementado (CRUD). Pendiente a√±adir acciones `approve` / `reject` y l√≥gica de verificaci√≥n.

3. **Visibilidad de Documentos para Propietario**
   * En `Dashboard.jsx` y `PropertyDetails.jsx` (si owner==viewer) mostrar lista y estado de verificaci√≥n.

4. **Flujo de Correo de Verificaci√≥n de Cuenta**
   * Implementar correo con token JWT y endpoint `verify-email/`.

5. **Funcionalidad de Favoritos (dependiente de Fase 2)**
   * Modelo `Favorite`, endpoints `/favorites/`, bot√≥n en `PropertyCard` y `PropertyDetails`.

6. **Mensajer√≠a / Contacto**
   * API `Conversation` + WebSocket (Django Channels) o fallback email.
   * UI: Chat minimal en `PropertyDetails`.

7. **Accesibilidad y SEO**
   * Revisar `alt` en im√°genes, contraste WCAG AA, meta tags React Helmet.

8. **Pruebas Autom√°ticas**
   * Aumentar cobertura Jest (frontend) y PyTest (backend) a >70 %.

9. **Pol√≠ticas de Retenci√≥n de Datos**
   * GDPR ‚Äì p√°gina Privacy Policy, endpoint `delete-account` y anonimizaci√≥n.

10. **Configuraci√≥n PWA**
   * `manifest.json`, Service Worker con precache de rutas cr√≠ticas.

11. **Optimizaci√≥n Build & Calidad de C√≥digo**
    * Configurar ESLint + Prettier pre-commit (husky) y CI.
    * Dividir c√≥digo con React.lazy/Suspense y Vite chunks para reducir TTFB.

12. **Error Boundaries Globales**
    * Crear componente `AppErrorBoundary` y log a Sentry.

Cada punto se a√±adir√° a la fase correspondiente durante planificaci√≥n semanal.

> Todas las tareas marcadas `[PENDIENTE]` se ir√°n trasladando a las Fases correspondientes conforme avance la implementaci√≥n.

### Pr√≥ximas Acciones Inmediatas (14 Jun 2025)
*   **Objetivo General:** Cerrar brechas cr√≠ticas identificadas en revisi√≥n del 13-Jun y preparar groundwork para despliegue AWS.
*   **Tareas Prioritarias (orden sugerido):**
    1.  **Backend ‚Äì Completar flujo de verificaci√≥n de documentos**
        *   A√±adir m√©todos `approve` y `reject` definitivos en `PropertyDocumentViewSet`.
        *   Se√±alar transici√≥n autom√°tica de `publication_status` en `Property` y emitir se√±al para notificaci√≥n.
        *   Tests PyTest para casos `approve`, `reject` y permisos.
    2.  **Frontend ‚Äì Visibilidad de documentos y estados**
        *   `PropertyDetails.jsx`: secci√≥n "Documentos" visible para owner/admin; listar archivos con estado.
        *   `Dashboard.jsx`: Indicador de verificaci√≥n en card de propiedad.
        *   `AdminDocumentsReviewPage.jsx`: conectar con endpoints `approve`/`reject` y feedback en tiempo real.
    3.  **IA Search Bar ‚Äì Resultados y animaci√≥n de vuelo**
        *   Renderizar panel con top-3 sugerencias alineado a lado izquierdo (token `surface-glass`).
        *   Al seleccionar sugerencia, ejecutar `map.flyTo` con duraci√≥n 4.5 s.
        *   Indicador de carga consistente entre b√∫squeda y flyTo.
    4.  **Script de superusuario por defecto**
        *   Management command `create_default_admin` usando variables de entorno para credenciales.
        *   Incluir ejecuci√≥n autom√°tica en pipeline `deploy_prod` si no existe usuario `admin`.
    5.  **Infra ‚Äì Bootstrap repo `skyterra-infra`**
        *   Estructura Terraform modular (`vpc`, `ecs`, `rds`, `s3`, `iam`, `alb`).
        *   README con pasos para `terraform init/plan/apply` y variables requeridas.
    6.  **UX ‚Äì Migraci√≥n a Liquid Glass restante (Sprint-focus)**
        *   Convertir `Dashboard`, `CreateProperty`, `PropertyCard` y formularios Auth a variantes `glass`.
        *   Eliminar estilos inline `rgba(22,27,34,*)` residuales.
    7.  **UX ‚Äì Redise√±o flujo Vendedor & Pesta√±as Modulares (Apple-style)**
        *   Elaborar wireframes de las nuevas secciones: Resumen, Mis Publicaciones, Crear Publicaci√≥n (wizard 4 pasos), Estad√≠sticas, Mensajes y Planes.
        *   Priorizar animaciones fluidas (Framer-motion) y uso de `variant="glass"` en contenedores principales.
        *   Preparar esquema de rutas y permisos (solo `role="seller"`).

*   **Meta de sprint:** Todas las tareas 1-4 marcadas `[COMPLETADO]` y 5-7 `[EN PROGRESO]` antes del 21-Jun-2025.

### 8. Nuevas Recomendaciones Incorporadas (Asesor√≠a 14-Jun-2025)

Las siguientes tareas se derivan de la gu√≠a UX/UI recibida. Se han verificado contra el log para evitar duplicados. Se marcan como [PENDIENTE] y se asignar√°n formalmente a la Fase indicada en la pr√≥xima planificaci√≥n semanal.

1. **Vista An√≥nima ‚Äì Vista Previa Limitada & CTA Registro** (Fase 1)
   * Backend: Serializer `PropertyPreviewSerializer` limitado + endpoint `/properties-preview/` que expone s√≥lo `id`, `title`, `price`, `main_image`, `location`, `surface`.
   * Frontend: `PropertyPreviewModal.jsx` muestra 3-5 fotos, datos b√°sicos y bot√≥n "Ver Tour 360¬∞ y Detalles Completos" que redirige a `/register`.
2. **Integraci√≥n Tours 360¬∞ (Pano2VR)** (Fase 2)
   * Backend: Soporte de subida de paquetes Pano2VR (`.ggpkg`) a S3 y campo `tour_url` en `Property`.
   * Frontend: Componente `<Pano2VRViewer>` embebido en `PropertyDetails.jsx` y en comparador.
3. **Comparador de Propiedades (m√°x. 4)** (Fase 2)
   * Backend: Modelo `ComparisonSession`, endpoints `/api/compare/` (GET IDs ‚Üí detalles) y WS para sync.
   * Frontend: `CompareView.jsx` con tabla de m√©tricas, columnas side-by-side y miniaturas del tour 360¬∞.
4. **B√∫squedas Guardadas & Alertas por Email** (Fase 2)
   * Backend: Modelo `SavedSearch` y Celery task para notificar al publicar nueva propiedad que coincida.
   * Frontend: Bot√≥n "Guardar b√∫squeda" en `AISearchBar`; panel "Alertas" en Dashboard.
5. **Suscripciones Premium ‚Äì Comprador** (Fase 3)
   * Backend: Modelo `Subscription`, roles `premium_buyer`, integraci√≥n initial Stripe Checkout.
   * Frontend: Paywall que muestra `plusvalia_score` y filtros avanzados s√≥lo si `role.includes('premium_buyer')`.
6. **Niveles de Producci√≥n Visual (Normal / Pro / Premium)** (Fase 3)
   * Backend: Tabla `ProductionLevel` y l√≥gica de pricing; se genera `ProductionOrder` tras pago √∫nico.
   * Frontend: Extender Paso 2 de `CreatePublicationWizard` con tarjetas comparativas y flujo de pago.
7. **Panel de Estad√≠sticas para Vendedor** (Fase 3)
   * Frontend: Widgets visitas & contactos √∫ltimos 30 d√≠as, gr√°fico de barras y tabla top-propiedades.
   * Backend: Endpoint `/api/seller/stats/` agregado y consultas agregadas.
8. **Panel Log√≠stico de Producci√≥n (Admin)** (Fase 3)
   * Backend: CRUD `ProductionOrder`, estados `Assigned ‚Üí Scheduled ‚Üí Done ‚Üí InReview ‚Üí Approved`.
   * Frontend: `AdminProductionPanel.jsx` con tabla, filtros por estado y asignaci√≥n r√°pida a piloto.

### Day 15: Overhauling User Dashboards & Theming
- **New Feature: Role-Based Dashboards.**
  - Implemented distinct, detailed dashboards for "Administrator" and "Seller" user roles.
  - **Admin Dashboard:**
    - Redesigned from the ground up to focus on SaaS and business KPIs.
    - Features 3 distinct sections:
      1.  **Business KPIs:** MRR, Churn Rate, LTV, and CAC cards.
      2.  **Operations & Finance:** A production/marketing queue and a donut chart for MRR breakdown by plan.
      3.  **Profitability Analysis:** Bar chart for LTV vs. CAC and a line chart for MRR evolution.
    - Created modular components for each part of the dashboard (`SaaSKpiCard`, `ProductionQueue`, `MrrBreakdownChart`, etc.).
  - **Seller Dashboard:**
    - Designed a new dashboard for professional sellers to track their performance.
    - Features 3 main sections:
      1.  **Plan Status:** Shows the seller's current plan, feature status (e.g., "Completed", "In Post-Production"), and an upsell card.
      2.  **Performance:** A detailed line chart for views/consultations over time and a set of KPI cards.
      3.  **Property Management:** A clean data table listing the seller's properties with key stats and actions.
    - Built using reusable components like `PlanStatus`, `PerformanceChart`, `PropertiesTable`, etc.
- **Technical Implementation:**
  - Used `Chart.js` for all new data visualizations.
  - Leveraged Material-UI `Grid` and components to create the structured, responsive layouts.
  - Implemented "Glassmorphism" style cards (`GlassCard`) for a modern, clean aesthetic on both dashboards.
  - Updated application routing in `App.jsx` to direct `is_staff` users to `/admin` and all other authenticated users to the new `/dashboard` (Seller Dashboard).
- **Project Structure:**
  - Created new directories to organize dashboard components: `frontend/src/components/seller/` and `frontend/src/components/admin/dashboard/`.
- **Next Steps:**
  - Wire up dashboards to live backend data.
  - Implement logic for different seller plans ("Due√±o Particular" vs "Vendedor Profesional").

## Session Date: 2024-07-26

### Summary of Changes:

Completed a major overhaul of the Admin Dashboard based on user feedback to improve functionality, UI, and centralization of management tasks.

### Detailed Changes:

1.  **Admin UI/Style Fixes:**
    *   Resolved an issue in the **Admin Dashboard** where KPI card values were displayed in white text, making them unreadable. They now correctly use the primary text color from the theme.
    *   Fixed an identical issue on the **Settings Page**, ensuring all form field labels are clearly visible.

2.  **Property Management Overhaul (`AdminDetailedPropertiesPage`):**
    *   **Centralized Management:** This page is now the central hub for managing properties, deprecating the separate "Documents" page.
    *   **Plusval√≠a Score:** Added a "Plusval√≠a Score" column with a visually intuitive `LinearProgress` bar and color-coding (red/yellow/green) to quickly assess property potential. The column is sortable.
    *   **Actions Menu:** Implemented a new "Actions" column with a menu for each property, providing access to management functions without leaving the page.
    *   **360 Tour Management:** The actions menu now contains a "Gestionar Tour 360" option, which opens a modal allowing the admin to upload a ZIP file for the property's virtual tour.
    *   **Integrated Document Review:** The "Documentos" tab has been removed from the main navigation. Functionality is now inside the property actions menu under "Ver Documentos". This opens a modal listing all documents for the selected property, showing their name, type, and verification status (`approved`, `pending`, `rejected`).

3.  **Ticket Management Enhancement (`AdminTicketsPage`):**
    *   **AI-Powered Priority:** Created a new mock `aiService` that automatically assigns a priority (`high`, `medium`, `low`) to each ticket based on keywords in its title.
    *   **Simulated Email Alerts:** The AI service now simulates an immediate email notification (via a `console.log`) for any ticket that is assigned a 'high' priority.
    *   **Interactive Ticket Response:** The ticket page is no longer static. Ticket cards are now clickable, opening a full-featured dialog box.
    *   **Conversation View:** Inside the dialog, admins can see the ticket's conversation history and post a new response, making the page a functional ticket management interface.

4.  **Data Mocks:**
    *   Updated `_mocks/properties.js` to include `plusvalia_score` and a `documents` array for each property.
    *   Created `_mocks/tickets.js` with more realistic data, including conversation history and priorities assigned by the new `aiService`.

5.  **Code Structure:**
    *   Removed the "Documentos" link from `AdminLayout.jsx`.
    *   The `AdminDocumentsReviewPage.jsx` component is now unused and can be deleted.

## Session Date: 2025-06-26 (Continuaci√≥n)

### Summary of Changes:

Se abordaron problemas de autenticaci√≥n, incluyendo mensajes de error detallados en el login y la configuraci√≥n de inicio de sesi√≥n social.

### Detailed Changes:

1.  **[RESUELTO]** Eliminaci√≥n de componente obsoleto:
    *   Se elimin√≥ `frontend/src/components/admin/AdminDocumentsReviewPage.jsx` y sus referencias en `frontend/src/App.jsx`.

2.  **[VERIFICADO]** Bug de registro de usuarios:
    *   Se confirm√≥ que el bug de registro de usuarios (`SMTPAuthenticationError`) no es un problema de c√≥digo de la aplicaci√≥n, sino de configuraci√≥n de credenciales de correo electr√≥nico para el env√≠o de emails de verificaci√≥n.
    *   Se verific√≥ que el `management command` `create_default_admin.py` ya existe y funciona para crear un superusuario por defecto.

3.  **[VERIFICADO]** Notificaciones por email al propietario:
    *   Se confirm√≥ que la funcionalidad de env√≠o de emails al propietario cuando el estado de su propiedad cambia ya est√° implementada en `backend/properties/views.py` (`PropertyDocumentViewSet`) y `backend/properties/email_service.py`.

4.  **[EN PROGRESO]** P√°gina de Perfil de Usuario (B√°sica):
    *   **Frontend:** Se a√±adi√≥ la pesta√±a "Mi Perfil" en `frontend/src/components/ui/Dashboard.jsx` y se cre√≥ el componente `frontend/src/components/ui/UserProfile.jsx` para la edici√≥n de datos b√°sicos del usuario.
    *   **Backend:** Se a√±adi√≥ el endpoint `/api/auth/profile/` (`ProfileUpdateView` en `backend/skyterra_backend/views.py`) para manejar la actualizaci√≥n del perfil.

5.  **[EN PROGRESO]** Mejora de la autenticaci√≥n y mensajes de error detallados:
    *   **Backend:** Se implement√≥ `CustomLoginSerializer` en `backend/skyterra_backend/serializers.py` para proporcionar mensajes de error m√°s espec√≠ficos ("Contrase√±a incorrecta", "Usuario o correo electr√≥nico no registrado") durante el inicio de sesi√≥n.
    *   **Frontend:** Se actualiz√≥ `frontend/src/components/ui/AuthForms.jsx` para interpretar y mostrar estos mensajes de error detallados.
    *   **Frontend:** Se a√±adi√≥ la interfaz de usuario para la recuperaci√≥n de contrase√±a (`ForgotPasswordForm` en `AuthForms.jsx`) y se integr√≥ con el endpoint de `dj-rest-auth`.

6.  **[PENDIENTE - Requiere Configuraci√≥n Externa]** Inicios de sesi√≥n con Google y X (Twitter):
    *   **Problema identificado:** Los errores como `The given origin is not allowed for the given client ID.` y `FedCM get() rejects with NetworkError: Error retrieving a token.` indican problemas de configuraci√≥n en las consolas de desarrolladores de Google y Twitter, no en el c√≥digo de la aplicaci√≥n.
    *   **Acciones requeridas por el usuario:**
        *   **Configuraci√≥n de Correo Electr√≥nico (para registro y recuperaci√≥n de contrase√±a):**
            *   Asegurarse de que las variables de entorno `EMAIL_HOST_USER`, `EMAIL_HOST_PASSWORD`, `DEFAULT_FROM_EMAIL`, y `ADMIN_EMAIL` est√©n configuradas correctamente en el archivo `.env`.
            *   **Importante:** Si se usa Gmail con 2FA, `EMAIL_HOST_PASSWORD` debe ser una "Contrase√±a de aplicaci√≥n" generada en la configuraci√≥n de seguridad de Google.
        *   **Configuraci√≥n de Google OAuth:**
            *   En Google Cloud Console (APIs y servicios -> Credenciales -> ID de cliente de OAuth 2.0 para la aplicaci√≥n web):
                *   Verificar que "Or√≠genes de JavaScript autorizados" incluya **todas las URLs exactas** del frontend (ej. `http://localhost:3000`, `http://localhost:5173`, `http://127.0.0.1:3000`, y URLs de producci√≥n).
                *   Verificar que "URI de redirecci√≥n autorizados" incluya las URLs de callback (ej. `http://localhost:3000/login`, `http://localhost:5173/login`).
        *   **Configuraci√≥n de Twitter (X) OAuth:**
            *   En el Twitter Developer Portal (Proyecto -> Aplicaci√≥n -> Configuraci√≥n):
                *   Verificar que los "Callback URLs" est√©n configurados correctamente.
    *   **Cambios en el c√≥digo:**
        *   Se actualiz√≥ `CLIENT_URL` en `backend/skyterra_backend/settings.py` a `http://localhost:5173` para desarrollo local.
        *   Se mejor√≥ el manejo de errores en `authService.googleLogin` y `authService.xLogin` en `frontend/src/services/api.js` para propagar mensajes de error m√°s detallados desde el backend.

### Day 15: Overhauling User Dashboards & Theming
- **New Feature: Role-Based Dashboards.**
  - Implemented distinct, detailed dashboards for "Administrator" and "Seller" user roles.
  - **Admin Dashboard:**
    - Redesigned from the ground up to focus on SaaS and business KPIs.
    - Features 3 distinct sections:
      1.  **Business KPIs:** MRR, Churn Rate, LTV, and CAC cards.
      2.  **Operations & Finance:** A production/marketing queue and a donut chart for MRR breakdown by plan.
      3.  **Profitability Analysis:** Bar chart for LTV vs. CAC and a line chart for MRR evolution.
    - Created modular components for each part of the dashboard (`SaaSKpiCard`, `ProductionQueue`, `MrrBreakdownChart`, etc.).
  - **Seller Dashboard:**
    - Designed a new dashboard for professional sellers to track their performance.
    - Features 3 main sections:
      1.  **Plan Status:** Shows the seller's current plan, feature status (e.g., "Completed", "In Post-Production"), and an upsell card.
      2.  **Performance:** A detailed line chart for views/consultations over time and a set of KPI cards.
      3.  **Property Management:** A clean data table listing the seller's properties with key stats and actions.
    - Built using reusable components like `PlanStatus`, `PerformanceChart`, `PropertiesTable`, etc.
- **Technical Implementation:**
  - Used `Chart.js` for all new data visualizations.
  - Leveraged Material-UI `Grid` and components to create the structured, responsive layouts.
  - Implemented "Glassmorphism" style cards (`GlassCard`) for a modern, clean aesthetic on both dashboards.
  - Updated application routing in `App.jsx` to direct `is_staff` users to `/admin` and all other authenticated users to the new `/dashboard` (Seller Dashboard).
- **Project Structure:**
  - Created new directories to organize dashboard components: `frontend/src/components/seller/` and `frontend/src/components/admin/dashboard/`.
- **Next Steps:**
  - Wire up dashboards to live backend data.
  - Implement logic for different seller plans ("Due√±o Particular" vs "Vendedor Profesional").